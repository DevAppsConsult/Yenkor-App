<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">
        <title>Blank Template for Bootstrap</title>
        <!-- Bootstrap core CSS -->
        <link href="bootstrap/css/bootstrap.css" rel="stylesheet">
        <!-- Custom styles for this template -->
        <link href="style.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="bootstrap-slider.css">
        <script src="cordova.js"></script>
        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
        <style>
            .clearable-input {
            position: relative;
            }
            .clearable-input > input {
            padding-right: 1.4em;
            }
            .clearable-input > [data-clear-input] {
            position: absolute;
            top: 5px;
            right: 0;
            font-weight: bold;
            font-size: 1.9em;
            padding: 0 0.2em;
            line-height: 1em;
            cursor: pointer;
            color:orange;
            }
            .clearable-input > input::-ms-clear {
            display: none;
            }





</style>
    </head>
    <body>
        <div style="height:105px;box-shadow: 0 1px 5px rgba(0,0,0,0.16), 0 1px 5px rgba(0,0,0,0.23);background-color:#F7F7F8;width:100%" class="container-fluid">
            <div class="row">
                <div class="pull-right col-xs-12 col-sm-12 col-md-12">
                    <div style="width:95%;height:101px;margin:0 auto;padding:10px;">
                        <div class="form-group clearable-input"> 
                            <input type="text" id="autocomplete_search" placeholder="Item Pick Up Location " class="form-control" style="box-shadow: 0 1px 5px rgba(0,0,0,0.16);border:1px solid lightgrey">
                            <span data-clear-input>&times;</span>
                        </div>
                        <div class="form-group clearable-input"> 
                            <input type="text" class="form-control" id="autocomplete2" placeholder="Destination" style="box-shadow: 0 1px 5px rgba(0,0,0,0.16);border:1px solid lightgrey">
                            <span data-clear-input>&times;</span>
                        </div>
                    </div>
                </div>
                <div class="menu">
                    <a href="#" data-toggle="modal" data-target="#modal1">
                        <div></div>
                        <div></div>
                        <div></div>
                    </a>
                </div>
            </div>
        </div>
        <div style="width:100%;background-color:white" class="container">
            <div class="row">
                <div class="col-md-12 col-xs-12 col-sm-12 nopadding">
                    <div class="home_img">
                        <div id="map-canvas" style="padding:100px" class="text-center">
                            <p class="notice text-center">
    Enter your Pick up point and Destination to display route</p> 
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="container" id="box" style="margin-top:20px">
            <div style="width:99%;height:200px;margin:0 auto;margin-top:13px;padding:5px">
                <div class="form-group"> 
                    <label class="control-label" for="formInput28">Courier Services close to you</label>
                    <select id="namez" class="form-control cour_list" style="box-shadow: 0 1px 5px rgba(0,0,0,0.16), 0 1px 5px rgba(0,0,0,0.23);border:1px solid lightgrey"> 
                        <option value="selected">Select a courier</option>
                    </select>
                </div>
                <div style="width:100%;height:74px;margin-bottom:8px;border-radius:5px;background-color:orange;margin-top:-1px">
                    <div class="row">
                        <div class="col-md-4 col-xs-3">
                            <div style="width:60px;height:60px;margin:0 auto;border-radius:50%;border:2px solid lightblue;margin-left:5px;margin-top:5px">
                                <img src="img/delivery-400-1.gif" class="img-responsive" style="height:100%;width:100%;border-radius:50%;padding:5px;background-color:white" />
                            </div>
                        </div>
                        <div class="col-md-4 col-xs-9">
                            <div style="color:black;font-size:13px;">
                                <h5 style="font-size:13px;" id="cou_name"></h5>
                                <h5 style="margin-top:-1px;font-size:13px;" id="distan"></h5>
                                <h5 style="margin-top:-1px;font-size:13px;" id="cost" class="cost"></h5>
                                <input type="hidden" id="foo" name="zyx" />
                            </div>
                        </div>
                    </div>
                </div>
                <button type="button" id="btn" class="btn btn-default btn-block" style="border:2px solid lightblue;background-color:black;color:white;border:2px solid white;border-top-left-radius:50px;border-bottom-left-radius:50px;border-top-right-radius:50px;border-bottom-right-radius:50px">Order  a Courier </button>
            </div>
        </div>
        <div class="modal fade" id="modal1" tabindex="-1" role="dialog" aria-hidden="true" style="position:absolute;top:100px;"> 
            <div class="modal-dialog"> 
                <div class="modal-content"> 
                    <div class="modal-header"> 
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>                         

                        <h4 class="modal-title text-center">Settings</h4> 
                    </div>                     

                    <div class="modal-body"> 
                        <div class="container">
                            <div class="row">
                                <div class="col-xs-12 col-sm-12 col-md-12">
                                    <div>
                                        <h5 class="text-center">Increase search radius</h5>
                                        <h5>Seach radius:</h5>
                                        <input id="ex6" type="range" data-slider-min="0" data-slider-max="50" data-slider-step="1" data-slider-value="5" />
                                        <p id="ex6SliderVal">Current Search Radius: 5 km</p>
                                        <p id="ex6SliderVal" class="text-center">The larger the radius the longer it will take for courier to reach your pickup location</p>
                                    </div>
                                </div>
                            </div>
                        </div>                         
                    </div>                     

                    <div class="modal-footer"> 
                        <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>                         

                        <button type="button" class="btn btn-primary pull-right">Save changes</button>                         
                    </div>                     
                </div>                 
            </div>             
        </div>
        <!-- Bootstrap core JavaScript
    ================================================== -->
        <!-- Placed at the end of the document so the pages load faster -->
        <script src="assets/js/jquery.min.js"></script>
        <script src="bootstrap/js/bootstrap.min.js"></script>
        <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
        <script src="assets/js/ie10-viewport-bug-workaround.js"></script>
        <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC9uDtR1X9zGXvO6h-LLhbSRU7Pq-Wz65k&amp;libraries=places,geometry"></script>
        <script src="check.js"></script>
        <script>
          var trip = [];
          Array.prototype.forEach.call(document.querySelectorAll('.clearable-input>[data-clear-input]'), function(el) {
  el.addEventListener('click', function(e) {
    e.target.previousElementSibling.value = '';
    if($('#autocomplete_search').val().length == ''){
      var selects = document.getElementById("namez");
      $("#namez option").remove();
      $('#autocomplete2').val("");
   }
  });
});
        </script>
        <script>
  navigator.geolocation.getCurrentPosition(function(position) {
            var pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            }
console.log(position);
          });

  google.maps.event.addDomListener(window, 'load', initialize);
    function initialize() {
      var input = document.getElementById('autocomplete_search');
      var autocomplete = new google.maps.places.Autocomplete(input);
      autocomplete.addListener('place_changed', function () {
      var start = autocomplete.getPlace();
      // place variable will have all the information you are looking for.
      var start_lat = start.geometry['location'].lat();
      var start_lon = start.geometry['location'].lng();
      autocomplete2 = new google.maps.places.Autocomplete(document.getElementById('autocomplete2'));
      $.getJSON('http://cosmicpictures.co.uk/port/couriers.php', function(data) {
var list = [];
      console.log(list);
    for(i=0;i<data.length;i++){ 
      var courier_id =data[i].courier_id;
      var courier_name =data[i].courier;
      var latitude2 =data[i].lat;
      var longitude2=data[i].lon;
      var distanz = google.maps.geometry.spherical.computeDistanceBetween(new google.maps.LatLng(start_lat, start_lon), new google.maps.LatLng(latitude2, longitude2));  
      var dist = distanz/1000;
      var numb = dist.toFixed(2);
      if (dist<5) {
        list.push({id: courier_id,name: courier_name,distance: numb});
        
        
      }
      
    }
   list.sort(function(a,b){return a.distance - b.distance})
   list.forEach(function (arrayItem) {
    var x = arrayItem.id + arrayItem.name + arrayItem.distance ;
    console.log(x);
     $('#namez').append($('<option>',
             {
                value: arrayItem.name,
                text : arrayItem.name +" " + arrayItem.distance +" km Away",
                'data-id': arrayItem.id
            }));
});
   
  
    })//gtjson
 


google.maps.event.addListener(autocomplete2, 'place_changed', function() {
  var ended = autocomplete2.getPlace();
  var destination_lat = ended.geometry['location'].lat();
  var destination_lon = ended.geometry['location'].lng();
  var origin1 = new google.maps.LatLng(start_lat, start_lon);
var destinationB = new google.maps.LatLng(destination_lat, destination_lon);
var iconBase = 'https://res.cloudinary.com/gabbyy/image/upload/v1566564455/map/';
function initMap() {
  var pointA = new google.maps.LatLng(start_lat, start_lon),
    pointB = new google.maps.LatLng(destination_lat, destination_lon),
    myOptions = {
      zoom: 7,
      center: pointA,
      disableDefaultUI: true,
      gestureHandling: "greedy"

    },
    map = new google.maps.Map(document.getElementById('map-canvas'), myOptions),
    // Instantiate a directions service.
    directionsService = new google.maps.DirectionsService,
    directionsDisplay = new google.maps.DirectionsRenderer({
      map: map,
      suppressMarkers: true
    }),
    markerA = new google.maps.Marker({
      position: pointA,
      map: map,
      icon: iconBase + 'scooter.png'

    }),
    markerB = new google.maps.Marker({
      position: pointB,
      map: map,
      icon: iconBase + 'alert.png'
    });

  // get route from A to B
  calculateAndDisplayRoute(directionsService, directionsDisplay, pointA, pointB);

}
initMap();

var service = new google.maps.DistanceMatrixService();
service.getDistanceMatrix(
  {
    origins: [origin1],
    destinations: [destinationB],
    travelMode: 'DRIVING',
    avoidHighways: true,
    avoidTolls: true,
  }, callback);
function callback(response, status) {
  if (status == 'OK') {
    var origins = response.originAddresses;
    var destinations = response.destinationAddresses;

    for (var i = 0; i < origins.length; i++) {
      var results = response.rows[i].elements;
      for (var j = 0; j < results.length; j++) {
        var element = results[j];
        var distance = element.distance.text;
        var duration = element.duration.text;
        var from = origins[i];
        var to = destinations[j];
        console.log(typeof(distance));
        document.getElementById("distan").innerHTML = "Trip Distance: "+ distance;
        var numz = distance.replace(/[^0-9\.]+/g,"");
        console.log(numz);
        trip[2]=numz;
        if (numz<10) {
          var c = (numz * 1.5).toFixed(2);
          trip[4]=c;
          $("#cost").text("Trip cost: GH¢"+ c);
          
         var z = $("#foo").val();
      
          console.log(z);
        } else if (numz>10 && numz < 20) {
          var c = (numz * 1.2).toFixed(2);
          trip[4]=c;
         $("#cost").text("Trip cost: GH¢"+ c);
         $("#foo").val(c);
         var z = $("#foo").val();
        } else if (numz > 20) {
          var c = numz * 1;
          trip[4]=c;
         $("#cost").text("Trip cost: GH¢"+ c);
        }
      }
      
    }
  }
}
});
      
    });


  
  }
//End of initialize function




function calculateAndDisplayRoute(directionsService, directionsDisplay, pointA, pointB) {
  directionsService.route({
    origin: pointA,
    destination: pointB,
    travelMode: google.maps.TravelMode.DRIVING
  }, function(response, status) {
    if (status == google.maps.DirectionsStatus.OK) {
      directionsDisplay.setDirections(response);
    } else {
      window.alert('Directions request failed due to ' + status);
    }
  });
}


$('#namez').change(function() {
  var a = $( "#namez").val();
  trip[3] = a;
document.getElementById("cou_name").innerHTML = a;
console.log($(this).find('option:selected').data('id'));
trip[6] = $(this).find('option:selected').data('id');
})
         

$("#btn").on("click",function(){
  var z = $("#autocomplete_search").val();
  var zz = $("#autocomplete2").val();
  trip[0] = z;
  trip[1] = zz;
  localStorage.setItem("request",JSON.stringify(trip));
  window.location.replace("request.html");
})
console.log(JSON.parse(localStorage.getItem("request")));
    document.addEventListener("deviceready", onDeviceReady, false);

    // Cordova is ready
    //
    function onDeviceReady() {
      
   var push = PushNotification.init({
  android: {
    
  },
    browser: {
        pushServiceURL: 'http://push.api.phonegap.com/v1/push'
    },
  ios: {
    alert: "true",
    badge: "true",
    sound: "true"
  },
  windows: {}
});

push.on('registration', function(data) {
  // data.registrationId
  console.log(data.registrationId);
  trip[5] = data.registrationId;
  
});

push.on('notification', function(data) {
  // data.message,
  // data.title,
  // data.count,
  // data.sound,
  // data.image,
  // data.additionalData
  if(data.additionalData.coldstart){
                  if(data.title=="Delivery Status"){
                    location.href="response.html";
                    }
                 }
  
  console.log(date.title);
  console.log(data.message);
  
});

push.on('error', function(e) {
  // e.message
  alert(e);
  console.log(e);
});

       
    }

</script>
        <script src="bootstrap-slider.js"></script>
        <script>
    $( document ).ready(function() {
    $("#ex6").slider();
$("#ex6").on("slide", function(slideEvt) {
    $("#ex6SliderVal").text(slideEvt.value + " km");
});
});
           
        </script>
    </body>
</html>
